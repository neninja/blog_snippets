<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Queries postgresql | Snippets</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Executa queries por comando"><meta property="og:title" content="Queries postgresql"><meta property="og:description" content="Executa queries por comando"><meta property="og:type" content="article"><meta property="og:url" content="http://s.neni.dev/vim/psql/"><meta property="article:section" content="vim"><meta property="article:published_time" content="2021-04-26T09:01:15-03:00"><meta property="article:modified_time" content="2021-04-26T09:01:15-03:00"><meta itemprop=name content="Queries postgresql"><meta itemprop=description content="Executa queries por comando"><meta itemprop=datePublished content="2021-04-26T09:01:15-03:00"><meta itemprop=dateModified content="2021-04-26T09:01:15-03:00"><meta itemprop=wordCount content="151"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Queries postgresql"><meta name=twitter:description content="Executa queries por comando"><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href=/css/themes/dark.css><link rel=stylesheet href=/css/themes/light.css><link rel=stylesheet href=/css/style.css></head><body><header><nav class="menu cabecalho" role=navigation><ul><li><a href=/>Snippets</a></li></ul></nav></header><main><article><header><div><a href=http://s.neni.dev/vim>VIM</a></div><h1>Queries postgresql</h1><time datetime=2021-04-26T09:01:15-03:00>26/04/2021</time><ul class=remote-options><li><a href=http://github.com/nenitf/blog_snippets/edit/main/content/vim/psql.md>Edite este post</a></li><li><a href=http://github.com/nenitf/blog_snippets/commits/main/content/vim/psql.md>Histórico de edição</a></li></ul></header><p>Realiza execução de queries com <code>:Psql &lt;query></code>, como <code>:Psql select * from users where nickname = 'Neni'</code>.</p><ul><li>No vimrc:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#75715e>&#34; vimrc</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>execute</span> <span style=color:#e6db74>&#39;source ~/.vimrc-local&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>function</span>! <span style=color:#a6e22e>s</span>:<span style=color:#a6e22e>PsqlComplete</span>(<span style=color:#a6e22e>A</span>, <span style=color:#a6e22e>L</span>, <span style=color:#a6e22e>P</span>) <span style=color:#a6e22e>abort</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>commands</span> = [ <span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \ <span style=color:#e6db74>&#34;SELECT &#34;</span>,<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \ <span style=color:#e6db74>&#34;SELECT * &#34;</span>,<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \ <span style=color:#e6db74>&#34;TOP &#34;</span>,<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \ <span style=color:#e6db74>&#34;FROM &#34;</span>,<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \ <span style=color:#e6db74>&#34;WHERE &#34;</span>,<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \ <span style=color:#e6db74>&#34;LIMIT &#34;</span>,<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \]<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>return</span> <span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>commands</span>, <span style=color:#e6db74>&#39;v:val =~ &#34;^&#34; . a:A&#39;</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>endfunction</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>
</span><span style=color:#75715e>&#34; THANKS: https://github.com/tpope/vim-dadbod</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>&#34; Psql select * from table where name = &#39;nome&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>command</span>! -<span style=color:#a6e22e>nargs</span>=+ -<span style=color:#a6e22e>complete</span>=<span style=color:#a6e22e>customlist</span>,<span style=color:#a6e22e>s</span>:<span style=color:#a6e22e>PsqlComplete</span> <span style=color:#a6e22e>Psql</span> <span style=color:#a6e22e>exe</span> <span style=color:#e6db74>&#39;RunCmd psql -w --dbname postgresql://&#39;</span>.<span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>dbs_psql</span>[<span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>db_psql</span>][<span style=color:#e6db74>&#34;url&#34;</span>].<span style=color:#e6db74>&#39; -c &#34;&#39;</span>.&lt;<span style=color:#a6e22e>q</span>-<span style=color:#a6e22e>args</span>&gt;.<span style=color:#e6db74>&#39;&#34;&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>command</span>! -<span style=color:#a6e22e>nargs</span>=<span style=color:#ae81ff>1</span> -<span style=color:#a6e22e>complete</span>=<span style=color:#a6e22e>customlist</span>,<span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>PsqlCompleteTable</span> <span style=color:#a6e22e>PsqlSelectAllFrom</span> <span style=color:#a6e22e>exe</span> <span style=color:#e6db74>&#39;Psql select * from &#39;</span>.&lt;<span style=color:#a6e22e>q</span>-<span style=color:#a6e22e>args</span>&gt;<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>command</span>! <span style=color:#a6e22e>PsqlSelectAllTables</span> <span style=color:#a6e22e>Psql</span> <span style=color:#a6e22e>SELECT</span> <span style=color:#a6e22e>table_name</span> <span style=color:#a6e22e>FROM</span> <span style=color:#a6e22e>information_schema</span>.<span style=color:#a6e22e>tables</span> <span style=color:#a6e22e>WHERE</span> <span style=color:#a6e22e>table_schema</span> = <span style=color:#e6db74>&#39;public&#39;</span> <span style=color:#a6e22e>ORDER</span> <span style=color:#a6e22e>BY</span> <span style=color:#a6e22e>table_name</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><ul><li>Em outro arquivo importado mas não versionado:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#75715e>&#34; vimrc-local</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>dbs_psql</span> = [<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  \ { <span style=color:#e6db74>&#39;name&#39;</span>: <span style=color:#e6db74>&#39;db_dev&#39;</span>, <span style=color:#e6db74>&#39;url&#39;</span>: <span style=color:#e6db74>&#39;username:password@localhost:5432/database&#39;</span> },<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  \ { <span style=color:#e6db74>&#39;name&#39;</span>: <span style=color:#e6db74>&#39;db_prod&#39;</span>, <span style=color:#e6db74>&#39;url&#39;</span>: <span style=color:#e6db74>&#39;username:password@localhost:5432/database&#39;</span> },<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  \ ]<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>db_psql</span> = <span style=color:#e6db74>&#39;db_dev&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>function</span>! <span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>PsqlCompleteTable</span>(<span style=color:#a6e22e>A</span>, <span style=color:#a6e22e>L</span>, <span style=color:#a6e22e>P</span>) <span style=color:#a6e22e>abort</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>commands</span> = [ <span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \ <span style=color:#e6db74>&#34;users&#34;</span>,<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                \]<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>return</span> <span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>commands</span>, <span style=color:#e6db74>&#39;v:val =~ &#34;^&#34; . a:A&#39;</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>endfunction</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div></article></main><footer><nav class=menu><ul><li><a href=http://neni.dev>neni.dev</a></li></ul></nav></footer></body></html>